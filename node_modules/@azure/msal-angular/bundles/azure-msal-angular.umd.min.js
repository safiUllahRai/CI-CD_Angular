!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/common"),require("@azure/msal-browser"),require("rxjs"),require("@angular/router"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("@azure/msal-angular",["exports","@angular/core","@angular/common","@azure/msal-browser","rxjs","@angular/router","rxjs/operators"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self).azure=e.azure||{},e.azure["msal-angular"]={}),e.ng.core,e.ng.common,e["@azure/msal-browser"],e.rxjs,e.ng.router,e.rxjs.operators)}(this,(function(e,t,r,o,n,i,a){"use strict";var s=new t.InjectionToken("MSAL_INSTANCE"),c=new t.InjectionToken("MSAL_GUARD_CONFIG"),u=new t.InjectionToken("MSAL_INTERCEPTOR_CONFIG"),l=new t.InjectionToken("MSAL_BROADCAST_CONFIG"),p="@azure/msal-angular",g="2.5.8",h=function(){function e(e,t){this.instance=e,this.location=t;var r=this.location.path(!0).split("#").pop();r&&(this.redirectHash="#"+r),this.instance.initializeWrapperLibrary(o.WrapperSKU.Angular,g)}return e.prototype.initialize=function(){return n.from(this.instance.initialize())},e.prototype.acquireTokenPopup=function(e){return n.from(this.instance.acquireTokenPopup(e))},e.prototype.acquireTokenRedirect=function(e){return n.from(this.instance.acquireTokenRedirect(e))},e.prototype.acquireTokenSilent=function(e){return n.from(this.instance.acquireTokenSilent(e))},e.prototype.handleRedirectObservable=function(e){return n.from(this.instance.handleRedirectPromise(e||this.redirectHash))},e.prototype.loginPopup=function(e){return n.from(this.instance.loginPopup(e))},e.prototype.loginRedirect=function(e){return n.from(this.instance.loginRedirect(e))},e.prototype.logout=function(e){return n.from(this.instance.logout(e))},e.prototype.logoutRedirect=function(e){return n.from(this.instance.logoutRedirect(e))},e.prototype.logoutPopup=function(e){return n.from(this.instance.logoutPopup(e))},e.prototype.ssoSilent=function(e){return n.from(this.instance.ssoSilent(e))},e.prototype.getLogger=function(){return this.logger||(this.logger=this.instance.getLogger().clone(p,g)),this.logger},e.prototype.setLogger=function(e){this.logger=e.clone(p,g),this.instance.setLogger(e)},e}();h.decorators=[{type:t.Injectable}],h.ctorParameters=function(){return[{type:void 0,decorators:[{type:t.Inject,args:[s]}]},{type:r.Location}]};var v=function(e,t,r){var i=this;this.msalInstance=e,this.authService=t,this.msalBroadcastConfig=r,this.msalBroadcastConfig&&this.msalBroadcastConfig.eventsToReplay>0?(this.authService.getLogger().verbose("BroadcastService - replayPastEvents set on BroadcastConfig, replaying the last "+this.msalBroadcastConfig.eventsToReplay+" events"),this._msalSubject=new n.ReplaySubject(this.msalBroadcastConfig.eventsToReplay)):this._msalSubject=new n.Subject,this.msalSubject$=this._msalSubject.asObservable(),this._inProgress=new n.BehaviorSubject(o.InteractionStatus.Startup),this.inProgress$=this._inProgress.asObservable(),this.msalInstance.addEventCallback((function(e){i._msalSubject.next(e);var t=o.EventMessageUtils.getInteractionStatusFromEvent(e,i._inProgress.value);null!==t&&(i.authService.getLogger().verbose("BroadcastService - "+e.eventType+" results in setting inProgress from "+i._inProgress.value+" to "+t),i._inProgress.next(t))}))};v.decorators=[{type:t.Injectable}],v.ctorParameters=function(){return[{type:void 0,decorators:[{type:t.Inject,args:[s]}]},{type:h},{type:void 0,decorators:[{type:t.Optional},{type:t.Inject,args:[l]}]}]};var f=function(){function e(e,t,r,o,n){this.msalGuardConfig=e,this.msalBroadcastService=t,this.authService=r,this.location=o,this.router=n,this.msalBroadcastService.inProgress$.subscribe()}return e.prototype.parseUrl=function(e){return this.router.parseUrl(e)},e.prototype.getDestinationUrl=function(e){this.authService.getLogger().verbose("Guard - getting destination url");var t=document.getElementsByTagName("base"),r=this.location.normalize(t.length?t[0].href:window.location.origin),o=this.location.prepareExternalUrl(e);return o.startsWith("#")?(this.authService.getLogger().verbose("Guard - destination by hash routing"),r+"/"+o):""+r+e},e.prototype.loginInteractively=function(e){var t=this,r="function"==typeof this.msalGuardConfig.authRequest?this.msalGuardConfig.authRequest(this.authService,e):Object.assign({},this.msalGuardConfig.authRequest);if(this.msalGuardConfig.interactionType===o.InteractionType.Popup)return this.authService.getLogger().verbose("Guard - logging in by popup"),this.authService.loginPopup(r).pipe(a.map((function(e){return t.authService.getLogger().verbose("Guard - login by popup successful, can activate, setting active account"),t.authService.instance.setActiveAccount(e.account),!0})));this.authService.getLogger().verbose("Guard - logging in by redirect");var n=this.getDestinationUrl(e.url);return this.authService.loginRedirect(Object.assign({redirectStartPage:n},r)).pipe(a.map((function(){return!1})))},e.prototype.activateHelper=function(e){var r=this;if(this.msalGuardConfig.interactionType!==o.InteractionType.Popup&&this.msalGuardConfig.interactionType!==o.InteractionType.Redirect)throw new o.BrowserConfigurationAuthError("invalid_interaction_type","Invalid interaction type provided to MSAL Guard. InteractionType.Popup or InteractionType.Redirect must be provided in the MsalGuardConfiguration");if(this.authService.getLogger().verbose("MSAL Guard activated"),"undefined"==typeof window)return this.authService.getLogger().info("Guard - window is undefined, MSAL does not support server-side token acquisition"),n.of(!0);if(o.UrlString.hashContainsKnownProperties(window.location.hash)&&o.BrowserUtils.isInIframe()&&!this.authService.instance.getConfiguration().system.allowRedirectInIframe)return this.authService.getLogger().warning("Guard - redirectUri set to page with MSAL Guard. It is recommended to not set redirectUri to a page that requires authentication."),n.of(!1);this.msalGuardConfig.loginFailedRoute&&(this.loginFailedRoute=this.parseUrl(this.msalGuardConfig.loginFailedRoute));var i=this.location.path(!0);return this.authService.handleRedirectObservable().pipe(a.concatMap((function(){if(!r.authService.instance.getAllAccounts().length)return e?(r.authService.getLogger().verbose("Guard - no accounts retrieved, log in required to activate"),r.loginInteractively(e)):(r.authService.getLogger().verbose("Guard - no accounts retrieved, no state, cannot load"),n.of(!1));if(r.authService.getLogger().verbose("Guard - at least 1 account exists, can activate or load"),e){var t=r.includesCode(e.url),o=!!e.root&&!!e.root.fragment&&r.includesCode("#"+e.root.fragment),a=0===r.location.prepareExternalUrl(e.url).indexOf("#");if(t&&(o||a))return r.authService.getLogger().info("Guard - Hash contains known code response, stopping navigation."),i.indexOf("#")>-1?n.of(r.parseUrl(r.location.path())):n.of(r.parseUrl(""))}return n.of(!0)})),a.catchError((function(o){return r.authService.getLogger().error("Guard - error while logging in, unable to activate"),r.authService.getLogger().errorPii("Guard - error: "+o.message),r.loginFailedRoute&&parseInt(t.VERSION.major,10)>9&&e?(r.authService.getLogger().verbose("Guard - loginFailedRoute set, redirecting"),n.of(r.loginFailedRoute)):n.of(!1)})))},e.prototype.includesCode=function(e){return e.lastIndexOf("/code")>-1&&e.lastIndexOf("/code")===e.length-"/code".length||e.indexOf("#code=")>-1||e.indexOf("&code=")>-1},e.prototype.canActivate=function(e,t){return this.authService.getLogger().verbose("Guard - canActivate"),this.activateHelper(t)},e.prototype.canActivateChild=function(e,t){return this.authService.getLogger().verbose("Guard - canActivateChild"),this.activateHelper(t)},e.prototype.canLoad=function(){return this.authService.getLogger().verbose("Guard - canLoad"),this.activateHelper()},e}();f.decorators=[{type:t.Injectable}],f.ctorParameters=function(){return[{type:void 0,decorators:[{type:t.Inject,args:[c]}]},{type:v},{type:h},{type:r.Location},{type:i.Router}]};var d=function(){function e(e,t,r,o,n){this.msalInterceptorConfig=e,this.authService=t,this.location=r,this.msalBroadcastService=o,this._document=n}return e.prototype.intercept=function(e,t){var r=this;if(this.msalInterceptorConfig.interactionType!==o.InteractionType.Popup&&this.msalInterceptorConfig.interactionType!==o.InteractionType.Redirect)throw new o.BrowserConfigurationAuthError("invalid_interaction_type","Invalid interaction type provided to MSAL Interceptor. InteractionType.Popup, InteractionType.Redirect must be provided in the msalInterceptorConfiguration");this.authService.getLogger().verbose("MSAL Interceptor activated");var n,i=this.getScopesForEndpoint(e.url,e.method);if(!i||0===i.length)return this.authService.getLogger().verbose("Interceptor - no scopes for endpoint"),t.handle(e);this.authService.instance.getActiveAccount()?(this.authService.getLogger().verbose("Interceptor - active account selected"),n=this.authService.instance.getActiveAccount()):(this.authService.getLogger().verbose("Interceptor - no active account, fallback to first account"),n=this.authService.instance.getAllAccounts()[0]);var s="function"==typeof this.msalInterceptorConfig.authRequest?this.msalInterceptorConfig.authRequest(this.authService,e,{account:n}):Object.assign(Object.assign({},this.msalInterceptorConfig.authRequest),{account:n});return this.authService.getLogger().info("Interceptor - "+i.length+" scopes found for endpoint"),this.authService.getLogger().infoPii("Interceptor - ["+i+"] scopes found for "+e.url),this.acquireToken(s,i,n).pipe(a.switchMap((function(o){r.authService.getLogger().verbose("Interceptor - setting authorization headers");var n=e.headers.set("Authorization","Bearer "+o.accessToken),i=e.clone({headers:n});return t.handle(i)})))},e.prototype.acquireToken=function(e,t,r){var i=this;return this.authService.acquireTokenSilent(Object.assign(Object.assign({},e),{scopes:t,account:r})).pipe(a.catchError((function(){return i.authService.getLogger().error("Interceptor - acquireTokenSilent rejected with error. Invoking interaction to resolve."),i.msalBroadcastService.inProgress$.pipe(a.take(1),a.switchMap((function(n){return n===o.InteractionStatus.None?i.acquireTokenInteractively(e,t):i.msalBroadcastService.inProgress$.pipe(a.filter((function(e){return e===o.InteractionStatus.None})),a.take(1),a.switchMap((function(){return i.acquireToken(e,t,r)})))})))})),a.switchMap((function(r){return r.accessToken?n.of(r):(i.authService.getLogger().error("Interceptor - acquireTokenSilent resolved with null access token. Known issue with B2C tenants, invoking interaction to resolve."),i.msalBroadcastService.inProgress$.pipe(a.filter((function(e){return e===o.InteractionStatus.None})),a.take(1),a.switchMap((function(){return i.acquireTokenInteractively(e,t)}))))})))},e.prototype.acquireTokenInteractively=function(e,t){if(this.msalInterceptorConfig.interactionType===o.InteractionType.Popup)return this.authService.getLogger().verbose("Interceptor - error acquiring token silently, acquiring by popup"),this.authService.acquireTokenPopup(Object.assign(Object.assign({},e),{scopes:t}));this.authService.getLogger().verbose("Interceptor - error acquiring token silently, acquiring by redirect");var r=window.location.href;return this.authService.acquireTokenRedirect(Object.assign(Object.assign({},e),{scopes:t,redirectStartPage:r})),n.EMPTY},e.prototype.getScopesForEndpoint=function(e,t){this.authService.getLogger().verbose("Interceptor - getting scopes for endpoint");var r=this.location.normalize(e),o=Array.from(this.msalInterceptorConfig.protectedResourceMap.keys()),n=this.matchResourcesToEndpoint(o,r);return n.absoluteResources.length>0?this.matchScopesToEndpoint(this.msalInterceptorConfig.protectedResourceMap,n.absoluteResources,t):n.relativeResources.length>0?this.matchScopesToEndpoint(this.msalInterceptorConfig.protectedResourceMap,n.relativeResources,t):null},e.prototype.matchResourcesToEndpoint=function(e,t){var r=this,n={absoluteResources:[],relativeResources:[]};return e.forEach((function(e){var i=r.location.normalize(e);o.StringUtils.matchPattern(i,t)&&n.absoluteResources.push(e);var a=r.getAbsoluteUrl(e),s=new o.UrlString(a).getUrlComponents(),c=r.getAbsoluteUrl(t),u=new o.UrlString(c).getUrlComponents(),l=s.QueryString?s.AbsolutePath+"?"+s.QueryString:r.location.normalize(s.AbsolutePath);s.HostNameAndPort===u.HostNameAndPort&&o.StringUtils.matchPattern(l,c)&&""!==l&&"/*"!==l&&n.relativeResources.push(e)})),n},e.prototype.getAbsoluteUrl=function(e){var t=this._document.createElement("a");return t.href=e,t.href},e.prototype.matchScopesToEndpoint=function(e,t,r){var o=[];return t.forEach((function(t){var n=[],i=e.get(t);null!==i?(i.forEach((function(e){if("string"==typeof e)n.push(e);else{var t=r.toLowerCase();e.httpMethod.toLowerCase()===t&&(null===e.scopes?o.push(null):e.scopes.forEach((function(e){n.push(e)})))}})),n.length>0&&o.push(n)):o.push(null)})),o.length>0?(o.length>1&&this.authService.getLogger().warning("Interceptor - More than 1 matching scopes for endpoint found."),o[0]):null},e}();d.decorators=[{type:t.Injectable}],d.ctorParameters=function(){return[{type:void 0,decorators:[{type:t.Inject,args:[u]}]},{type:h},{type:r.Location},{type:v},{type:void 0,decorators:[{type:t.Inject,args:[r.DOCUMENT]}]}]};var y=function(){function e(e){this.authService=e}return e.prototype.ngOnInit=function(){var e=this;this.authService.getLogger().verbose("MsalRedirectComponent activated"),this.authService.initialize().pipe(a.concatMap((function(){return e.authService.handleRedirectObservable()}))).subscribe()},e}();y.decorators=[{type:t.Component,args:[{selector:"app-redirect",template:""}]}],y.ctorParameters=function(){return[{type:h}]};var S=function(){function e(){}return e.forRoot=function(t,r,o){return{ngModule:e,providers:[{provide:s,useValue:t},{provide:c,useValue:r},{provide:u,useValue:o},h]}},e}();S.decorators=[{type:t.NgModule,args:[{declarations:[y],imports:[r.CommonModule],providers:[f,v]}]}];var m=function(e,t){return(m=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)};function b(e,t,r,o){return new(r||(r=Promise))((function(n,i){function a(e){try{c(o.next(e))}catch(e){i(e)}}function s(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))}function I(e,t){var r,o,n,i,a={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(c){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(a=0)),a;)try{if(r=1,o&&(n=2&s[0]?o.return:s[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,s[1])).done)return n;switch(o=0,n&&(s=[2&s[0],n.value]),s[0]){case 0:case 1:n=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,o=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(n=a.trys,(n=n.length>0&&n[n.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!n||s[1]>n[0]&&s[1]<n[3])){a.label=s[1];break}if(6===s[0]&&a.label<n[1]){a.label=n[1],n=s;break}if(n&&a.label<n[2]){a.label=n[2],a.ops.push(s);break}n[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],o=0}finally{r=n=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}}Object.create;Object.create;var C=function(e){function t(t,r,o){var n=e.call(this)||this;return n.authService=t,n.router=r,n.location=o,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}m(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}(t,e),t.prototype.navigateInternal=function(t,r){var n=Object.create(null,{navigateInternal:{get:function(){return e.prototype.navigateInternal}}});return b(this,void 0,void 0,(function(){var e,i;return I(this,(function(a){return this.authService.getLogger().trace("MsalCustomNavigationClient called"),this.authService.getLogger().verbose("MsalCustomNavigationClient - navigating"),this.authService.getLogger().verbosePii("MsalCustomNavigationClient - navigating to url: "+t),r.noHistory?[2,n.navigateInternal.call(this,t,r)]:(e=new o.UrlString(t).getUrlComponents(),i=e.QueryString?e.AbsolutePath+"?"+e.QueryString:this.location.normalize(e.AbsolutePath),this.router.navigateByUrl(i,{replaceUrl:r.noHistory}),[2,Promise.resolve(r.noHistory)])}))}))},t}(o.NavigationClient);C.decorators=[{type:t.Injectable}],C.ctorParameters=function(){return[{type:h},{type:i.Router},{type:r.Location}]},e.MSAL_BROADCAST_CONFIG=l,e.MSAL_GUARD_CONFIG=c,e.MSAL_INSTANCE=s,e.MSAL_INTERCEPTOR_CONFIG=u,e.MsalBroadcastService=v,e.MsalCustomNavigationClient=C,e.MsalGuard=f,e.MsalInterceptor=d,e.MsalModule=S,e.MsalRedirectComponent=y,e.MsalService=h,e.version=g,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=azure-msal-angular.umd.min.js.map